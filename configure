#!/bin/sh

#
# Default options
#
app=magicrescue
prefix=/usr/local
env_vars="CC CFLAGS CPPFLAGS LDFLAGS"
def_CC=cc
def_CFLAGS="-O3 -Wall"

#
# Environment
#
for var in $env_vars; do
    eval ": \${$var:=\$def_$var}"
    export $var
done

#
# Parse arguments
#
for option; do
    case "$option" in

    --help)
    	cat << EOF
This will configure $app for your system.

Options:
  --prefix=DIR    Path to install under [$prefix]
  CC=COMMAND      C compiler to use [$CC]
  CFLAGS=COMMAND  C compiler flags [$CFLAGS]
EOF
	exit
	;;

    --*=*)
	arg=`echo "$option"|cut -d= -f 2`
	case "$option" in
	--prefix=*)
	    prefix="$arg"
	    ;;
	*)
	    echo "configure: warning: ignoring option $option"
	    ;;
	esac
	;;

    *=*)
	export "$option"
    esac
done

#
# Generate config.h
#
rm -f config.h 2>/dev/null || chmod 644 config.h
cat > config.h << EOF
/* XXX This file automatically generated by configure. */

#define COMMAND_PATH "$prefix/share/$app/commands"
#define RECIPE_PATH  "$prefix/share/$app/recipes"
EOF
chmod 444 config.h

#
# Generate Makefile
#
rm -f Makefile 2>/dev/null || chmod 644 Makefile
cat > Makefile << EOF
# XXX This Makefile is automatically generated by configure.
# XXX Modify Makefile.in to change it.

PREFIX = $prefix
EOF

for var in $env_vars; do
    eval "val=\"\$$var\""
    echo "$var = $val" >> Makefile
done

cat Makefile.in >> Makefile
chmod 444 Makefile

echo "Done. Now type 'make' to compile"
